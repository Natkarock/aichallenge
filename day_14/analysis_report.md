# Архитектурный обзор и рекомендации по проекту fly

## 1. Архитектура (Высокоуровневое описание)

### Модули и слои
- **Мобильный клиент (iOS/Android):**
  - Присутствуют папки, относящиеся к iOS (`ios/`) и Android (`android/`).
  - Используется React Native (указание на `Platform` в JS-коде), большое количество общих JS-файлов (например, `src/constants/commons.js`).
- **Локализация:**
  - Локализационные файлы хранятся в формате JSON (например, `src/utils/translate/reducers/translate-ru.json`), что указывает на поддержку мультиязычности.
- **Константные данные и параметры:**
  - Значения по умолчанию (геопозиция, лимиты, подписи и описания, слайды onboarding) собраны в `src/constants/commons.js`.
- **Интеграции с соц. сетями и оплатами:**
  - Судя по Info.plist, интеграция с Facebook и VK (`CFBundleURLSchemes`), а также описание оплаты через Fondy в интерфейсе.
- **Работа с платформенными возможностями:**
  - Info.plist содержит разрешения для камеры, геолокации, микрофона, фото, распознавания речи.

### Поток данных
- **Onboarding/приветствие** — выбор слайдов и подстановка данных в зависимости от платформы.
- **Локализация** — выгрузка переводов из JSON.
- **Авторизация** — социальные сети и email.
- **Офферы/подписки** — показ и фильтрация предложений, управление подпиской.

### Зависимости и интеграции
- React Native / JS-стэк (по структуре и кодовым фрагментам).
- iOS/Android окружение (Xcode, Gradle, разрешения в Info.plist, Android project).
- Интеграция с платежной системой Fondy.
- Социальная авторизация (Facebook, VK).

## 2. Баги, антипаттерны, риски

### Уязвимости, потенциальные баги, запахи кода

- **[Info.plist] (/ios/fly/Info.plist):**
    - `NSAppTransportSecurity -> NSAllowsArbitraryLoads: true`
      - **Риск безопасности**: Возможность подключения по незащищённым HTTP.
      - **Рекомендация**: Отключить в релизных сборках, оставить исключение только для localhost при разработке.
- **[Константы JS] (/src/constants/commons.js):**
    - Отсутствие централизованного контроля версий переводов (JSON могут устаревать или расходиться по платформам).
    - Смешение данных для презентации (слайды, изображения) и бизнес-логики (константы, значения по умолчанию).
    - Возможные дублирующие объекты или несогласованность между web, ios и android (например, путь к картинкам).
- **[Локализация] (/src/utils/translate/reducers/translate-ru.json):**
    - Нет явного механизма fallback (например, для недостающих ключей при добавлении новых функций).
    - Названия и структура файлов не интуитивны — «reducers» не отражает локализационный смысл.
    - Возможен рассинхрон локализаций между платформами (разные версии файлов для ios/assets и src).
- **[Android project] (/android/.project):**
    - Проект на Eclipse Buildship, что устарело (актуальнее использовать чистый Gradle через Android Studio).
- **[CI/CD, тестирование]:**
    - Не найдено признаков автоматических тестов, скриптов или YAML-конфигов для CI (например, Github Actions, Bitrise, или Fastlane для mobile).

## 3. Рекомендации и следующая структура работ

### Улучшение структуры и рефакторинг
- **Константы:**
    - Разделите константы по смыслу: `constants/ui.js`, `constants/business.js`, `constants/images.js`.
- **Локализация:**
    - Сведите локализацию к единой папке типа `/locales/<язык>.json`.
    - Внедрите механизм fallback для строк.
    - Поддерживать автоматическую синхронизацию локализаций между платформами (тулзы типа i18next).
- **Переименуйте и структурируйте папки:**
    - `/src/components` — UI компоненты (раздельно для платформ при необходимости).
    - `/src/screens` — экранные компоненты.
    - `/src/services` — логика работы с сервером, API, оплатами.
    - `/src/utils` — хелперы.
    - `/src/constants` — только бизнес и презентационные константы.
    - `/locales` — языковые файлы.
- **Для изображений:**  
    - Вынести все картинки в `/assets/images/`, явно указать относительные пути, убрать дубли.

### Тесты, CI/CD
- **Покрытие тестами:**
    - Добавить unit-тесты (Jest для React Native).
    - Скриншотные/интеграционные тесты — Detox или Appium.
- **CI/CD:**
    - Внедрить Github Actions/Bitrise/Fastlane:
        - Автоматические сборки всех платформ.
        - Проверка локализаций на консистентность.
        - Проверка builds на релизных и debug-конфигурациях.
    - Проверка наличия критических разрешений или инсекьюрных настроек (например, запрещать `NSAllowsArbitraryLoads` на мастере).

### Безопасность и качество
- **iOS Info.plist:**
    - Запретить NSAllowsArbitraryLoads кроме локалхоста для разработки.
    - Проверить список разрешённых URL- и query-схем.
- **Секреты и доступы:**
    - Хранить ключи и чувствительные данные вне репозитория, использовать .env файлы.
- **Обновить устаревшие практики (android/.project):**
    - Снести Eclipse-наследие, перейти на стандартную структуру Gradle-проектов.

---

## TLDR: Кратко

- **Архитектура**: React Native, используются платформенные фичи, локализация JSON, константы JS, интеграции через соц. сети и платежи.
- **Риски**: 
    - Открыты все HTTP в iOS;
    - Локализация разбросана, нет fallback;
    - Устаревший android .project;
    - Смешение бизнес и UI-логики.
- **Рекомендации**:
    - Разделите код по слоям и зонам ответственности;
    - Централизуйте и автоматизируйте локализацию;
    - Внедрите тесты, CI/CD;
    - Усильте работу с безопасностью приложений на релизах.