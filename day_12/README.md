
# ‚õÖ Weather ‚Üí Image ‚Üí PDF (MCP Agent)

Streamlit-—á–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É —á–µ—Ä–µ–∑ MCP-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
1) –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–≥–æ–¥—É (MCP `weather_mcp`),  
2) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—é (MCP `image-gen` / Replicate),  
3) —Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π Markdown-–æ—Ç—á—ë—Ç –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –µ–≥–æ –≤ PDF (MCP `markdown2pdf`).  

–í —á–∞—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ **–∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å ‚Äú—à–∏–º–º–µ—Ä–æ–º‚Äù** –Ω–∞ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏. PDF —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫.

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üó£Ô∏è –ü—Ä–æ—Å—Ç–æ–µ –æ–±—â–µ–Ω–∏–µ: –≤–≤–æ–¥–∏—Ç–µ ¬´–ü–æ–≥–æ–¥–∞ –≤ <–≥–æ—Ä–æ–¥–µ>¬ª ‚Äî –∞–≥–µ–Ω—Ç —Å–∞–º —Ä–µ—à–∞–µ—Ç, –∫–∞–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤—ã–∑—ã–≤–∞—Ç—å.  
- üå§Ô∏è MCP-–ø–æ–≥–æ–¥–∞ ‚Üí –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞.  
- üñºÔ∏è MCP-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Üí —Å–ø–∏—Å–æ–∫ URL, –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –≤ UI —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º **shimmer-–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–º**.  
- üìÑ MCP-–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Markdown‚ÜíPDF ‚Üí —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –ø–∞–ø–∫—É.  
- üß© –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö LangGraph/LCEL + LangChain + `langchain_mcp_adapters`.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–º–∏–Ω–∏–º—É–º)

```
project/
‚îú‚îÄ main.py           # Streamlit UI (—à–∏–º–µ—Ä, –ø–∞—Ä—Å–∏–Ω–≥ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ JSON)
‚îú‚îÄ agent.py          # –ì—Ä–∞—Ñ –∞–≥–µ–Ω—Ç–∞: weather ‚Üí image ‚Üí markdown2pdf (MCP)
‚îú‚îÄ requirements.txt  # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îî‚îÄ .env              # –ö–ª—é—á–∏ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å–º. –Ω–∏–∂–µ)
```

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1) Python –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt

# 2) Node.js (–¥–ª—è markdown2pdf –∏ image-gen —á–µ—Ä–µ–∑ npx)
# macOS: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node 18+ (–∏–ª–∏ –Ω–æ–≤–µ–µ). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
node -v
npx -v
```

---

## üîë –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ä—è–¥–æ–º —Å –ø—Ä–æ–µ–∫—Ç–æ–º (–∏–ª–∏ –≤—ã—Å—Ç–∞–≤–ª—è–π—Ç–µ –≤ —Å–∏—Å—Ç–µ–º–µ/IDE):

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ / —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ
```
OPENAI_API_KEY=sk-...                # –∫–ª—é—á –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ OpenAI (–¥–ª—è ChatOpenAI)
OPENAI_MODEL=gpt-4.1-mini            # –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ UI (sidebar)

REPLICATE_API_TOKEN=r8_...           # —Ç–æ–∫–µ–Ω Replicate –¥–ª—è image-gen MCP
REPLICATE_MODEL=google/nano-banana   # –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ UI (sidebar)
```

### MCP Weather
```
# –í agent.py —É–∂–µ —É–∫–∞–∑–∞–Ω –ø—É–±–ª–∏—á–Ω—ã–π SSE URL, –Ω–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–º–µ–Ω–∏—Ç–µ:
# WEATHER_MCP_URL=https://your-weather-mcp.example/mcp
```

### MCP Markdown‚ÜíPDF
```
# –ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è pdf; –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
M2P_OUTPUT_DIR=/abs/path/to/output/dir

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

```bash
streamlit run main.py
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è UI. –í–≤–µ–¥–∏—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:  
`–ü–æ–≥–æ–¥–∞ –≤ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–µ`  

–ê–≥–µ–Ω—Ç –≤—ã–∑–æ–≤–µ—Ç MCP-–ø–æ–≥–æ–¥—É ‚Üí —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É ‚Üí —Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç Markdown –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç PDF.

---

## üß† –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

- `main.py`
  - –ø–µ—Ä–µ–¥–∞—ë—Ç –∑–∞–ø—Ä–æ—Å –≤ `agent.run_with_message(prompt)`;
  - –±–µ—Ä—ë—Ç **–ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** –∏–∑ `result["messages"]` ‚Äî —Ç–∞–º –ª–µ–∂–∏—Ç **–≤–∞–ª–∏–¥–Ω—ã–π JSON**:
    ```json
    {
      "description": "–ü–æ–≥–æ–¥–∞ –≤ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–µ: ...",
      "images": [
        "https://replicate.delivery/.../out-0.webp"
      ]
    }
    ```
  - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç `description` –∏ **–ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å shimmer**.

- `agent.py`
  - —Å–æ–±–∏—Ä–∞–µ—Ç MCP-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ `MultiServerMCPClient`;
  - —Å—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ (`StateGraph`): —É–∑–µ–ª –∞–≥–µ–Ω—Ç–∞ ‚Üí `ToolNode` ‚Üí –∞–≥–µ–Ω—Ç ‚Ä¶ –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ JSON;
  - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
    - `weather_mcp` (HTTP SSE),
    - `image-gen` (stdio, `npx @gongrzhe/image-gen-server`),
    - `markdown2pdf` (stdio, `npx markdown2pdf-mcp@latest` **–∏–ª–∏** `node build/index.js`).

---

## üß™ –ü—Ä–∏–º–µ—Ä —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

```json
{
  "description": "–ü–æ–≥–æ–¥–∞ –≤ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–µ: —Å–µ–π—á–∞—Å —è—Å–Ω–æ, –æ–∫–æ–ª–æ 10¬∞C. –í –±–ª–∏–∂–∞–π—à–∏–µ —Ç—Ä–∏ –¥–Ω—è ‚Äî –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–∞—Å–º—É—Ä–Ω–æ, 14‚Äì18¬∞C –¥–Ω—ë–º.",
  "images": ["https://replicate.delivery/.../out-0.webp"]
}
```

