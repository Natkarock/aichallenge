# üìö RAG Chat Agent 

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç --- –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π **RAG‚Äë—á–∞—Ç‚Äë–∞–≥–µ–Ω—Ç**, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞
Streamlit + OpenAI + FAISS, –∫–æ—Ç–æ—Ä—ã–π:

-   –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã,
-   –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ RAG,
-   **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏**,
-   –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ –≤ UI,
-   —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–æ–≤ –≤ SQLite,
-   –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ RAG‚Äë—Ä–µ–∂–∏–º–∞,
-   –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç summary –¥–∏–∞–ª–æ–≥–∞.

------------------------------------------------------------------------

## üß† –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úîÔ∏è 1. RAG-–ø–æ–∏—Å–∫

-   –î–æ–∫—É–º–µ–Ω—Ç—ã —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏
-   –ò–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –≤ FAISS
-   RAG –ø–æ–¥–±–∏—Ä–∞–µ—Ç —Ç–æ–ø‚Äë—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
-   –í –æ—Ç–≤–µ—Ç LLM –≤–∫–ª—é—á–∞—é—Ç—Å—è **—Ü–∏—Ç–∞—Ç—ã + –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º**

------------------------------------------------------------------------

### ‚úîÔ∏è 2. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ LLM

LLM *–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ* —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ä–∞–∑–¥–µ–ª:

    –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
    `/path/to/file.txt` ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–í UI —ç—Ç–∏ —Ñ–∞–π–ª—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫: - –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ expander-–±–ª–æ–∫–∏, - —Å
–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º —Ç–µ–∫—Å—Ç–∞, - —Å –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–º –ø—É—Ç—ë–º —Ñ–∞–π–ª–∞.

------------------------------------------------------------------------

### ‚úîÔ∏è 3. –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:

-   `.txt`, `.md`, `.json`, `.csv`
-   `.py`, `.log`
-   `.xls`, `.xlsx` (—á–µ—Ä–µ–∑ pandas)

–ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Ñ–∞–π–ª: - —á–∏—Ç–∞–µ—Ç—Å—è, - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `memory/rag/files/`, -
—Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏, - –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `file_id`, - –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤
FAISS.

------------------------------------------------------------------------

### ‚úîÔ∏è 4. –ü–∞–º—è—Ç—å —á–∞—Ç–æ–≤ (SQLite)

–§–∞–π–ª `memory/chats.db` —Å–æ–¥–µ—Ä–∂–∏—Ç:

-   —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤,
-   —Å–æ–æ–±—â–µ–Ω–∏—è (`role`, `content`, `ts`),
-   summary –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞—Ç–∞,
-   —Ñ–ª–∞–≥ `rag_enabled`.

–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite --- –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:

    st.session_state["message_sources"]

–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ—Ä–µ–Ω–¥–µ—Ä–µ UI.

------------------------------------------------------------------------

### ‚úîÔ∏è 5. –î–µ—Ç–∞–ª—å–Ω—ã–π UI –Ω–∞ Streamlit

–í –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏:

-   —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤,
-   —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞,
-   —Ñ–ª–∞–≥ ¬´–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RAG¬ª,
-   —Ñ–ª–∞–≥ ¬´–í–∫–ª—é—á–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏¬ª,
-   –∑–∞–≥—Ä—É–∑—á–∏–∫ —Ñ–∞–π–ª–æ–≤,
-   —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

–í —á–∞—Ç–µ:

-   –∂–∏–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è,
-   –ø–æ—Ç–æ–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç,
-   —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–µ—Å—è –±–ª–æ–∫–∏ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.

------------------------------------------------------------------------

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

    .
    ‚îú‚îÄ‚îÄ main.py            # UI, –ª–æ–≥–∏–∫–∞ —á–∞—Ç–∞, –≤—ã–≤–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    ‚îú‚îÄ‚îÄ llm.py             # –õ–æ–≥–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ LLM, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ RAG-–ø–æ–¥—Å–∫–∞–∑–æ–∫
    ‚îú‚îÄ‚îÄ rag_store.py       # –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è, FAISS, —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
    ‚îú‚îÄ‚îÄ cache.py           # SQLite, —Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –∏ summary
    ‚îú‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    ‚îú‚îÄ‚îÄ README.md          # –≠—Ç–æ—Ç —Ñ–∞–π–ª
    ‚îî‚îÄ‚îÄ memory/
        ‚îú‚îÄ‚îÄ rag/
        ‚îÇ   ‚îú‚îÄ‚îÄ files/         # –ö–æ–ø–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        ‚îÇ   ‚îú‚îÄ‚îÄ faiss_index/   # FAISS-–≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å
        ‚îÇ   ‚îî‚îÄ‚îÄ meta.json      # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–æ–≤
        ‚îî‚îÄ‚îÄ chats.db           # SQLite-–±–∞–∑–∞ —á–∞—Ç–æ–≤

------------------------------------------------------------------------


## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç RAG

1.  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –≤–æ–ø—Ä–æ—Å.
2.  –ï—Å–ª–∏ RAG –≤–∫–ª—é—á—ë–Ω:
    -   —Å–æ–∑–¥–∞—é—Ç—Å—è —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤–æ–ø—Ä–æ—Å–∞,
    -   FAISS –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–µ chunk-–∏,
    -   —Å—Ç—Ä–æ–∏—Ç—Å—è prompt, –≤–∫–ª—é—á–∞—é—â–∏–π:
        -   –≤–æ–ø—Ä–æ—Å,
        -   retrieved-docs,
        -   JSON‚Äë–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
3.  LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç **—Å—Ç—Ä–æ–≥–æ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É**.
4.  –í –∫–æ–Ω—Ü–µ –æ—Ç–≤–µ—Ç–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –±–ª–æ–∫ ¬´–ò—Å—Ç–æ—á–Ω–∏–∫–∏¬ª.
5.  UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ —Å —Ñ–∞–π–ª–∞–º–∏.

------------------------------------------------------------------------

## üìÑ –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

    –í–æ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞...

    –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
    `/memory/rag/files/4b23e-f123-tz_recipes.txt` ‚Äî –¢–ó –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–ü–æ–¥ –æ—Ç–≤–µ—Ç–æ–º UI –ø–æ–∫–∞–∂–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–∞–Ω–µ–ª–∏:

    –û—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏:
    ‚ñæ tz_recipes.txt
       /memory/rag/files/4b23e...
       [—Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞]

------------------------------------------------------------------------

## üéõ –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –í —Å–∞–π–¥–±–∞—Ä–µ:

  -----------------------------------------------------------------------
  –ü–∞—Ä–∞–º–µ—Ç—Ä                          –û–ø–∏—Å–∞–Ω–∏–µ
  --------------------------------- -------------------------------------
  **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RAG**              –ï—Å–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å --- LLM –æ—Ç–≤–µ—á–∞–µ—Ç –±–µ–∑
                                    –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

  **–í–∫–ª—é—á–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏**  –ó–∞—Å—Ç–∞–≤–ª—è–µ—Ç LLM –≤–∫–ª—é—á–∞—Ç—å —Ä–∞–∑–¥–µ–ª
                                    ¬´–ò—Å—Ç–æ—á–Ω–∏–∫–∏¬ª

  **–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã**           –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –≤ FAISS

  **–ü—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**      –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é
                                    —É–¥–∞–ª–µ–Ω–∏—è
  -----------------------------------------------------------------------

------------------------------------------------------------------------

## üìö –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π

### `main.py`

-   UI Streamlit –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
-   –≤—ã–≤–æ–¥ —á–∞—Ç–∞
-   –ø–æ—Ç–æ–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã
-   —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
-   sidebar —Å —Ñ–∞–π–ª–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
-   —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RAG-—Ä–µ–∂–∏–º–æ–º

### `llm.py`

-   —Ñ—É–Ω–∫—Ü–∏–∏:
    -   `generate_reply`
    -   `generate_rag_reply`
    -   `summarize_messages`
-   —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ RAG‚Äëprompt'–æ–≤
-   —Å—Ç—Ä–æ–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –±–ª–æ–∫–∞ ¬´–ò—Å—Ç–æ—á–Ω–∏–∫–∏¬ª

### `rag_store.py`

-   –∑–∞–≥—Ä—É–∑–∫–∞, —á—Ç–µ–Ω–∏–µ –∏ —Ä–∞–∑–±–æ—Ä —Ñ–∞–π–ª–æ–≤
-   —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–ø–∏–π —Ñ–∞–π–ª–æ–≤
-   —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏
-   —Å–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ `Document`
-   FAISS:
    -   –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
    -   –ø–æ–∏—Å–∫
    -   reindex_all
-   —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ `meta.json`

### `cache.py`

-   SQLite
-   create/load/save store
-   —Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤, —Å–æ–æ–±—â–µ–Ω–∏–π, summary


------------------------------------------------------------------------

## üõ† –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–°–º–æ—Ç—Ä–∏ `requirements.txt`.

------------------------------------------------------------------------
